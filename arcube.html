<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Cube Placement</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    #arButton {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 20px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      z-index: 999;
      cursor: pointer;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-family: Arial, sans-serif;
      z-index: 1000;
      text-align: center;
      padding: 20px;
    }
    
    .overlay h2 {
      margin-bottom: 20px;
    }
    
    .overlay p {
      margin-bottom: 30px;
      max-width: 600px;
    }
    
    .overlay button {
      padding: 12px 24px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <div id="startOverlay" class="overlay">
    <h2>AR Cube Placement</h2>
    <p>This demo places rotating cubes 5 feet (1.5 meters) in front of you. The cubes will stay fixed in real-world space.</p>
    <button id="startButton">Start AR Experience 1</button>
  </div>

  <!-- AR.js scene with embedded camera -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
    renderer="logarithmicDepthBuffer: true;"
    vr-mode-ui="enabled: false">
    
    <!-- The camera with AR.js controls -->
    <a-camera id="camera"></a-camera>
    
    <!-- Container for all cubes -->
    <a-entity id="cubeContainer"></a-entity>
  </a-scene>
  
  <button id="arButton" style="display: none;">PLACE A CUBE HERE</button>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const startButton = document.getElementById('startButton');
      const startOverlay = document.getElementById('startOverlay');
      const arButton = document.getElementById('arButton');
      const cubeContainer = document.getElementById('cubeContainer');
      const camera = document.getElementById('camera');
      
      let cubeCount = 0;
      
      // Start AR experience
      startButton.addEventListener('click', function() {
        startOverlay.style.display = 'none';
        arButton.style.display = 'block';
      });
      
      // Place cube button
      arButton.addEventListener('click', function() {
        cubeCount++;
        
        // Get the camera position and rotation
        const cameraPosition = camera.object3D.position;
        const cameraRotation = camera.object3D.rotation;
        
        // Direction vector (forward direction of camera)
        const direction = new THREE.Vector3(0, 0, -1);
        direction.applyQuaternion(camera.object3D.quaternion);
        direction.normalize();
        
        // Calculate position 5 feet (1.5 meters) in front of camera
        const distance = 1.5;
        const position = new THREE.Vector3();
        position.copy(cameraPosition);
        position.addScaledVector(direction, distance);
        
        // Random color
        const colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        
        // Create a cube entity as world-relative
        const cubeEntity = document.createElement('a-entity');
        cubeEntity.setAttribute('id', `cube-entity-${cubeCount}`);
        
        // Add the cube
        const cube = document.createElement('a-box');
        cube.setAttribute('id', `cube-${cubeCount}`);
        cube.setAttribute('color', color);
        cube.setAttribute('width', '0.5');
        cube.setAttribute('height', '0.5');
        cube.setAttribute('depth', '0.5');
        cube.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear');
        
        // World position for the entity
        cubeEntity.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
        cubeEntity.appendChild(cube);
        
        // Add to scene
        cubeContainer.appendChild(cubeEntity);
        
        // Update the button text
        arButton.textContent = `PLACED ${cubeCount} CUBE(S) - TAP FOR MORE`;
        
        console.log(`Cube ${cubeCount} placed at:`, position);
      });
    });
  </script>
</body>
</html>