<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fixed AR Cube - Markerless</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <style>
    .info-panel {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      font-family: Arial, sans-serif;
      z-index: 999;
      border-radius: 5px;
      max-width: 300px;
    }
    
    #placeButton {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 30px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      z-index: 999;
    }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <button id="placeButton">PLACE CUBE HERE</button>
  <div class="info-panel">
    Press the button to place a cube 5 feet away from your current position. The cube will stay fixed in real space.
  </div>
  
  <a-scene embedded arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;" renderer="antialias: true; logarithmicDepthBuffer: true;">
    <a-entity id="world-root"></a-entity>
    <a-camera id="camera" look-controls-enabled='true' position="0 1.6 0"></a-camera>
  </a-scene>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const placeButton = document.getElementById('placeButton');
      const camera = document.getElementById('camera');
      const worldRoot = document.getElementById('world-root');
      const infoPanel = document.querySelector('.info-panel');
      let hasPlacedCube = false;
      
      placeButton.addEventListener('click', function() {
        if (hasPlacedCube) return;
        hasPlacedCube = true;
        
        // Get camera's current position and rotation
        const camPosition = camera.getAttribute('position');
        const camRotation = camera.getAttribute('rotation');
        
        // Create an invisible anchor at camera position
        const anchor = document.createElement('a-entity');
        anchor.setAttribute('position', `${camPosition.x} 0 ${camPosition.z}`);
        worldRoot.appendChild(anchor);
        
        // Calculate position 5 feet in front of user (about 1.5 meters)
        // We need to convert camera's rotation to radians
        const rotY = camRotation.y * (Math.PI / 180);
        const distance = 1.5; // 5 feet in meters
        
        const xOffset = -Math.sin(rotY) * distance;
        const zOffset = -Math.cos(rotY) * distance;
        
        // Create the cube
        const cube = document.createElement('a-box');
        cube.setAttribute('position', `${xOffset} 1.2 ${zOffset}`);
        cube.setAttribute('color', 'red');
        cube.setAttribute('width', '0.5');
        cube.setAttribute('height', '0.5');
        cube.setAttribute('depth', '0.5');
        cube.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear');
        anchor.appendChild(cube);
        
        // Add a line from ground to cube
        const line = document.createElement('a-entity');
        line.setAttribute('line', `start: ${xOffset} 0 ${zOffset}; end: ${xOffset} 1.2 ${zOffset}; color: blue;`);
        anchor.appendChild(line);
        
        // Add floating text
        const text = document.createElement('a-text');
        text.setAttribute('value', '5 feet away');
        text.setAttribute('position', `${xOffset} 1.8 ${zOffset}`);
        text.setAttribute('align', 'center');
        text.setAttribute('color', 'white');
        text.setAttribute('look-at', '#camera');
        text.setAttribute('scale', '0.5 0.5 0.5');
        anchor.appendChild(text);
        
        // Update info panel
        infoPanel.innerHTML = 'Cube placed 5 feet in front of you.<br>The cube should remain fixed as you move around.';
        
        // Hide button
        placeButton.style.display = 'none';
        
        console.log('Cube placed at: ', xOffset, zOffset);
      });
    });
  </script>
</body>
</html>