<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Basic AR Cube Demo</title>
  <!-- Use the most reliable AR.js version -->
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/2.2.2/aframe/build/aframe-ar.min.js"></script>
  <style>
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: Arial, sans-serif;
      z-index: 999;
      text-align: center;
      padding: 20px;
    }
    
    .overlay img {
      max-width: 250px;
      background: white;
      margin: 15px;
      border: 2px solid white;
    }
    
    .overlay button {
      padding: 15px 30px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      margin-top: 20px;
      cursor: pointer;
    }
    
    .button {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      z-index: 10;
      cursor: pointer;
    }
    
    #status {
      position: fixed;
      top: 10px;
      left: 0;
      width: 100%;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 5px;
      text-align: center;
      font-family: Arial, sans-serif;
      z-index: 10;
    }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">
  <!-- Intro screen -->
  <div id="intro" class="overlay">
    <h2>Simple AR Cube Demo</h2>
    <p>This demo shows a 3D cube when pointing at a HIRO marker.</p>
    <p>Point your camera at this marker:</p>
    <img src="https://raw.githack.com/AR-js-org/AR.js/master/data/images/HIRO.jpg" alt="HIRO Marker">
    <button id="startButton">Start AR Experience 20</button>
  </div>
  
  <!-- Status message -->
  <div id="status" style="display: none;">Looking for HIRO marker...</div>
  
  <!-- Button to place fixed cube (will show once marker is found) -->
  <button id="placeButton" class="button" style="display: none;">Place Fixed Cube</button>

  <!-- AR Scene (initially hidden) -->
  <a-scene id="arScene" embedded arjs="sourceType: webcam; debugUIEnabled: false;" style="display: none;">
    <!-- HIRO Marker -->
    <a-marker preset="hiro" id="hiroMarker">
      <!-- Yellow box to indicate marker detection -->
      <a-box position="0 0.5 0" color="yellow" scale="0.3 0.3 0.3"></a-box>
    </a-marker>
    
    <!-- Camera -->
    <a-entity camera></a-entity>
    
    <!-- This entity will hold our fixed cube -->
    <a-entity id="fixedCubeContainer"></a-entity>
  </a-scene>

  <script>
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Get DOM elements
      const intro = document.getElementById('intro');
      const startButton = document.getElementById('startButton');
      const status = document.getElementById('status');
      const placeButton = document.getElementById('placeButton');
      const arScene = document.getElementById('arScene');
      const marker = document.getElementById('hiroMarker');
      const fixedCubeContainer = document.getElementById('fixedCubeContainer');
      
      let cubeCreated = false;
      
      // Start AR experience
      startButton.addEventListener('click', function() {
        // Hide intro and show AR scene
        intro.style.display = 'none';
        arScene.style.display = 'block';
        status.style.display = 'block';
        
        // Setup marker detection events
        if (marker) {
          marker.addEventListener('markerFound', function() {
            status.textContent = 'HIRO marker found! Click button to place cube.';
            placeButton.style.display = 'block';
          });
          
          marker.addEventListener('markerLost', function() {
            if (!cubeCreated) {
              status.textContent = 'Marker lost. Point camera at HIRO marker again.';
              placeButton.style.display = 'none';
            } else {
              status.textContent = 'Cube placed in fixed position.';
            }
          });
        }
      });
      
      // Place fixed cube when button is clicked
      placeButton.addEventListener('click', function() {
        if (cubeCreated) return;
        
        // Create a fixed position cube (relative to the camera's view)
        const cube = document.createElement('a-box');
        cube.setAttribute('color', 'red');
        cube.setAttribute('position', '0 0 -3');  // 3 meters in front of camera
        cube.setAttribute('scale', '0.5 0.5 0.5');
        cube.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 8000');
        
        // Add to scene at current camera position
        document.querySelector('a-scene').appendChild(cube);
        
        // Mark as created
        cubeCreated = true;
        status.textContent = 'Cube placed! It should stay fixed in position as you move.';
        placeButton.textContent = 'Cube Placed';
      });
    });
  </script>
</body>
</html>