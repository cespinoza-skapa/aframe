<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Fixed Cube</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  
  <script>
    AFRAME.registerComponent('ar-location-fixed', {
      init: function() {
        navigator.geolocation.getCurrentPosition(position => {
          // Store original position
          const originLat = position.coords.latitude;
          const originLon = position.coords.longitude;
          
          // Set data on scene for other components to access
          const scene = document.querySelector('a-scene');
          scene.setAttribute('data-origin-latitude', originLat);
          scene.setAttribute('data-origin-longitude', originLon);
          
          // Calculate position 5 feet (approx 1.5 meters) away
          // Creating a fixed point north of the user
          const distance = 1.5; // 5 feet in meters
          const fixedCube = document.querySelector('#fixed-cube');
          
          // Position 5 feet north (negative z in A-Frame coordinates)
          fixedCube.setAttribute('position', '0 1 -' + distance);
          fixedCube.setAttribute('visible', 'true');
          
          console.log('Origin position set:', originLat, originLon);
          console.log('Cube placed at 5 feet north of origin');
          
          // Add a text label
          const label = document.createElement('a-text');
          label.setAttribute('value', '5 feet north');
          label.setAttribute('position', '0 1.5 -' + distance);
          label.setAttribute('color', 'white');
          label.setAttribute('align', 'center');
          label.setAttribute('scale', '0.5 0.5 0.5');
          label.setAttribute('look-at', '[camera]');
          document.querySelector('a-scene').appendChild(label);
        }, 
        function(error) {
          console.error('Error getting location:', error);
          alert('Unable to get your location. Please enable location services and try again.');
        }, 
        { enableHighAccuracy: true });
      }
    });
  </script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    arjs="sourceType: webcam; debugUIEnabled: true;">
    
    <!-- Use a custom component to manage positioning -->
    <a-entity ar-location-fixed></a-entity>

    <!-- Hidden by default, shown when position is determined -->
    <a-box id="fixed-cube"
      position="0 0 0"
      color="red"
      scale="0.3 0.3 0.3"
      visible="false"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear">
    </a-box>
    
    <!-- Fixed line to origin -->
    <a-entity line="start: 0 0 0; end: 0 1 -1.5; color: yellow"></a-entity>
    
    <!-- Camera -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    
  </a-scene>
  
  <div style="position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; font-family: monospace; z-index: 999;">
    The red cube should be fixed 5 feet (1.5m) north of your starting position.<br>
    Move around to see if it stays in place.
  </div>
</body>
</html>